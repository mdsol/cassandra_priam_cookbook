{"name":"cassandra-priam","description":"Installs Priam-managed Cassandra","long_description":"Description\n===========\n\nThis cookbook exists to achieve a deployment of a [Priam][1] Managed [Cassandra][2] Cluster.\n\nThis cookbook elects a leader to create the necessary [SimpleDB][3] databases/configuration entries to manage the deployment along with some Priam/Cassandra configuration [Properties][4] managed via chef attributes.\n\nPriam is a sidecar application that takes care of Cassandra Configuration, Startup, Seeding and Node Replacement, Backups (to s3) and Restoration (from s3). It makes the lifecycle of Cassandra clusters much easier to manage.\n\nThis cookbook installs the [JNA][5] package.\n\n### Special Caveats:\n\nThis cookbook and the software it deploys are only designed to work under AWS EC2 with [Autoscaling][6] and [SimpleDB][3].\n\nYou should check that the credentials you provide have the necessary accesss to use the relevant AWS services.\n\n### General Caveats:\n\n#### Java:\n\nThe software this cookbook installs has mostly been tested with the Oracle JRE - your mileage may vary on other JRE builds. \n\n#### SimpleDB:\n\nContact Amazon to get your SimpleDB limits increased moderately with your usage.\n\n#### Cluster, Role and Autoscaling Group Naming\n\nWhen creating a cluster, there are several places where the reference must be identical/matching for things to work as expected.\n\nThese references should ideally all be the same and globally unique - although some are suffixed with identifiers, and some are not that global (security groups are regional).\n\nDashes are a used as a separator, so we try and use underscores where possible.\n\nUse the following as a guide / concept for your own naming:\n\nAutoscaling Group Name : ````unique_cassandra_cluster_one-useast1````\n\nNote that we indicate the region the group is in at the end of the name with a dash separator. \n\nRole Name :              ````unique-cassandra-cluster-one | unique_cassandra_cluster_one````\n\nThis must be unique within the chef API, shared between all members members of the cluster.\n\nCluster Name :           ````unique_cassandra_cluster_one````\n\nIf a cluster name is not configured directly we will make one out of the role name, replacing dashes (-) with underscores (_)\n\nSecurity Group Name :    ````unique_cassandra_cluster_one````\n\nPriam will attempt to configure security groups itself in each region if it is in multiregion mode. It will not however create them : They should be created matching the cluster name (i.e. the ASG name before the region suffix).\n\nSee the ec2/autoscaling commands at the bottom of this document for a clearer picture of some of the implications.\n\n#### AWS Credentials:\n\nThis cookbook tries to pick up AWS credentials from an encrypted databag by default in the same location as the ebs cookbook and others use (bag: credentials item: aws). See the attributes for more information.\n\nRequirements\n============\n* Chef 10.16.4+\n* [Amazon Autoscaling][6]\n* [Amazon SimpleDB][3]\n* [Java cookbook][8]\n* [Tomcat cookbook][9]\n* [Fog Gem][10]\n\n## Platform\n\n* Ubuntu 12.04+ [tested heavily]\n* Probably other Linux Distros with some tweaking of package names where appropriate. \n\nNote: This cookbook does not call any package managers directly but rather through the chef package resource, but package names and installation paths may differ.\n\nAttributes\n==========\n\nSee the contents of `attributes/default.rb` where there are accurate comments and self-explanatory attribute names.\n\nRecipes\n=======\n\n* `default.rb` : A dummy recipe pointing to install.rb\n* `install.rb` : Installs everything by calling the rest of the recipes in the right order. Includes a leadership election section for applying simpledbconfig\n* `awscredentials.rb` : Creates AWS Credentials on the /etc filesystem\n* `cassandra.rb` : Installs Cassandra\n* `optimizations.rb` : Applies Optimizations to limits.d\n* `priam.rb` : Installs Priam\n* `simpledbconfig.rb` : Applies SimpleDB configuration\n\nUsage\n=====\n\nInclude cassandra-priam in your unique role's runlist.\n\n### Recommended deployment variables:\n\nThe following example variables should be in the unique role's \"overrides\" attributes section:\n\n#### singleregion:\n\n```JSON\n{\n  \"cassandra\": {\n    \"priam_s3_bucket\": \"YOURORG-cassandra-backups\",\n  },\n  \"tomcat\":{\n     \"base_version\": \"7\"\n  },\n  \"java\": {\n    \"install_flavor\": \"oracle\",\n    \"jdk_version\": \"7\",\n    \"oracle\": {\n      \"accept_oracle_download_terms\": \"true\"\n    }\n  }\n}\n```\n\n#### multiregion:\n\n```JSON\n{\n  \"cassandra\": {\n    \"priam_s3_bucket\": \"YOURORG-cassandra-backups\",\n    \"priam_multiregion_enable\": \"true\",\n    \"priam_endpoint_snitch\": \"org.apache.cassandra.locator.Ec2MultiRegionSnitch\",\n    \"priam_zones_available\": \"us-east-1a,us-east-1b,us-east-1c,us-west-1a,us-west-1b,us-west-1c\",\n  },\n  \"tomcat\":{\n     \"base_version\": \"7\"\n  },\n  \"java\": {\n      \"install_flavor\": \"oracle\",\n      \"jdk_version\": \"7\",\n      \"oracle\" : {\n        \"accept_oracle_download_terms\": \"true\"\n      }\n   }\n}\n```\n\n### Putting It Together with Autoscaling Commands\n\n#### singleregion\n\n```SHELL\nas-create-launch-config unique_cassandra_cluster_one-useast1 --region us-east-1 --image-id ami-a73264ce --instance-type m1.small --monitoring-disabled --group unique-cassandra-cluster-name --key aws_ssh_keypair_id --user-data-file chefregistrationetc.txt\nas-create-auto-scaling-group unique_cassandra_cluster_one-useast1 --region us-east-1 --launch-configuration unique_cassandra_cluster_name-useast1 --max-size 4 --min-size 2 --availability-zones us-east-1a,us-east-1b,us-east-1c\n```\n\n#### multiregion\n\n```SHELL\nec2-create-group --region us-east-1 unique_cassandra_cluster_two -d unique_cassandra_cluster_two\nec2-create-group --region us-west-1 unique_cassandra_cluster_two -d unique_cassandra_cluster_two\nas-create-launch-config unique_cassandra_cluster_two-useast1 --region us-east-1 --image-id ami-a73264ce --instance-type m1.small --monitoring-disabled --group unique_cassandra_cluster_two --key aws_ssh_keypair_id --user-data-file chefregistrationetc.txt \nas-create-launch-config unique_cassandra_cluster_two-uswest1 --region us-west-1 --image-id ami-acf9cde9 --instance-type m1.small --monitoring-disabled --group unique_cassandra_cluster_two --key aws_ssh_keypair_id --user-data-file chefregistrationetc.txt\nas-create-auto-scaling-group unique_cassandra_cluster_two-useast1 --region us-east-1 --launch-configuration unique_cassandra_cluster_two-useast1 --max-size 4 --min-size 2 --availability-zones us-east-1a,us-east-1b,us-east-1c\nas-create-auto-scaling-group unique_cassandra_cluster_two-uswest1 --region us-west-1 --launch-configuration unique_cassandra_cluster_two-uswest1 --max-size 4 --min-size 2 --availability-zones us-west-1a,us-west-1b,us-west-1c\n```\n\nDevelopment\n===========\n\nSee the [Github page][7]\n\n[1]: https://github.com/Netflix/Priam\n[2]: http://planetcassandra.org\n[3]: http://aws.amazon.com/simpledb\n[4]: https://github.com/Netflix/Priam/wiki/Properties\n[5]: https://github.com/twall/jna\n[6]: http://aws.amazon.com/autoscaling\n[7]: https://github.com/mdsol/cassandra_priam_cookbook\n[8]: http://community.opscode.com/cookbooks/java\n[9]: http://community.opscode.com/cookbooks/tomcat\n[10]: https://rubygems.org/gems/fog\n\nAuthors\n=======\n\n* Author: Alex Trull <atrull@mdsol.com>\n* Author: Benton Roberts <broberts@mdsol.com>\n\nCopyright: 2013â€“2013 Medidata Solutions, Inc.\n","maintainer":"Medidata Solutions, Inc.","maintainer_email":"cookbooks@mdsol.com","license":"Apache 2.0","platforms":{"ubuntu":">= 0.0.0","debian":">= 0.0.0","redhat":">= 0.0.0","fedora":">= 0.0.0","centos":">= 0.0.0","scientific":">= 0.0.0","amazon":">= 0.0.0"},"dependencies":{"sudo":">= 0.0.0","runit":">= 0.0.0","java":">= 0.0.0","tomcat":">= 0.0.0"},"recommendations":{},"suggestions":{},"conflicting":{},"providing":{},"replacing":{},"attributes":{},"groupings":{},"recipes":{},"version":"0.0.6"}
